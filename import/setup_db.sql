--  Run this in snowflake UI first to create the database and schema 
CREATE OR REPLACE DATABASE FEC COMMENT='Data from Fedderal Election Commission website: https://www.fec.gov/data/browse-data/?tab=bulk-data';


USE DATABASE FEC;
GRANT USAGE ON DATABASE FEC TO ROLE SNOWFLAKE_LEARNING_ROLE;
GRANT CREATE SCHEMA ON DATABASE FEC TO ROLE SNOWFLAKE_LEARNING_ROLE;
GRANT USAGE ON WAREHOUSE SNOWFLAKE_LEARNING_WH TO ROLE SNOWFLAKE_LEARNING_ROLE;

CREATE SCHEMA RAW;
GRANT ALL ON SCHEMA raw TO ROLE SNOWFLAKE_LEARNING_ROLE;
GRANT CREATE STAGE ON SCHEMA raw TO ROLE SNOWFLAKE_LEARNING_ROLE;
GRANT CREATE FILE FORMAT ON SCHEMA raw TO ROLE SNOWFLAKE_LEARNING_ROLE;
GRANT CREATE TABLE ON SCHEMA raw TO ROLE SNOWFLAKE_LEARNING_ROLE;
GRANT SELECT ON ALL TABLES IN SCHEMA FEC.RAW TO ROLE SNOWFLAKE_LEARNING_ROLE;

CREATE SCHEMA DIMENSIONAL;
GRANT ALL ON SCHEMA DIMENSIONAL TO ROLE SNOWFLAKE_LEARNING_ROLE;
GRANT CREATE STAGE ON SCHEMA DIMENSIONAL TO ROLE SNOWFLAKE_LEARNING_ROLE;
GRANT CREATE FILE FORMAT ON SCHEMA DIMENSIONAL TO ROLE SNOWFLAKE_LEARNING_ROLE;
GRANT CREATE TABLE ON SCHEMA DIMENSIONAL TO ROLE SNOWFLAKE_LEARNING_ROLE;
GRANT SELECT ON ALL TABLES IN SCHEMA FEC.DIMENSIONAL TO ROLE SNOWFLAKE_LEARNING_ROLE;

CREATE SCHEMA ANALYTICS;
GRANT ALL ON SCHEMA ANALYTICS TO ROLE SNOWFLAKE_LEARNING_ROLE;
GRANT CREATE STAGE ON SCHEMA ANALYTICS TO ROLE SNOWFLAKE_LEARNING_ROLE;
GRANT CREATE FILE FORMAT ON SCHEMA ANALYTICS TO ROLE SNOWFLAKE_LEARNING_ROLE;
GRANT CREATE TABLE ON SCHEMA ANALYTICS TO ROLE SNOWFLAKE_LEARNING_ROLE;
GRANT SELECT ON ALL TABLES IN SCHEMA FEC.ANALYTICS TO ROLE SNOWFLAKE_LEARNING_ROLE;



-- This will get your environment variables from Snowflake.
-- Run it and paste results into .env in root of repo (edit your password!)
-- Remember to include ".env" in .gitignore!
SELECT
    'SNOWFLAKE_USER=' || CURRENT_USER() AS env_var
UNION ALL
SELECT
    'SNOWFLAKE_ACCOUNT=' || CURRENT_ACCOUNT()
UNION ALL
SELECT
    'SNOWFLAKE_ROLE=' || CURRENT_ROLE()
UNION ALL
SELECT
    'SNOWFLAKE_WAREHOUSE=' || CURRENT_WAREHOUSE()
UNION ALL
SELECT
    'SNOWFLAKE_DATABASE=' || CURRENT_DATABASE()
UNION ALL
SELECT
    'SNOWFLAKE_SCHEMA=' || CURRENT_SCHEMA()
UNION ALL
SELECT
    'SNOWFLAKE_PASSWORD=PUT_PASSWORD_HERE!!';


-- Make tables to be populated from raw FEC data files
create or replace TABLE FEC.RAW.CANDIDATE (
	CAND_ID VARCHAR(16777216),
	CAND_NAME VARCHAR(16777216),
	CAND_PTY_AFFILIATION VARCHAR(16777216),
	CAND_ELECTION_YR VARCHAR(16777216),
	CAND_OFFICE_ST VARCHAR(16777216),
	CAND_OFFICE VARCHAR(16777216),
	CAND_OFFICE_DISTRICT VARCHAR(16777216),
	CAND_ICI VARCHAR(16777216),
	CAND_STATUS VARCHAR(16777216),
	CAND_PCC VARCHAR(16777216),
	CAND_ST1 VARCHAR(16777216),
	CAND_ST2 VARCHAR(16777216),
	CAND_CITY VARCHAR(16777216),
	CAND_ST VARCHAR(16777216),
	CAND_ZIP VARCHAR(16777216),

	INGEST_TIMESTAMP TIMESTAMP_NTZ,
	SOURCE_FILE_NAME VARCHAR,
	SOURCE_FILE_ROW_NUMBER NUMBER,
	SOURCE_FILE_YEAR VARCHAR(4)
);

create or replace TABLE FEC.RAW.CANDIDATE_COMMITTEE (
	CAND_ID VARCHAR(16777216),
	CAND_ELECTION_YR VARCHAR(16777216),
	FEC_ELECTION_YR VARCHAR(16777216),
	CMTE_ID VARCHAR(16777216),
	CMTE_TP VARCHAR(16777216),
	CMTE_DSGN VARCHAR(16777216),
	LINKAGE_ID VARCHAR(16777216),

	INGEST_TIMESTAMP TIMESTAMP_NTZ,
	SOURCE_FILE_NAME VARCHAR,
	SOURCE_FILE_ROW_NUMBER NUMBER,
	SOURCE_FILE_YEAR VARCHAR(4)
);

create or replace TABLE FEC.RAW.COMMITTEE (
	CMTE_ID VARCHAR(16777216),
	CMTE_NM VARCHAR(16777216),
	TRES_NM VARCHAR(16777216),
	CMTE_ST1 VARCHAR(16777216),
	CMTE_ST2 VARCHAR(16777216),
	CMTE_CITY VARCHAR(16777216),
	CMTE_ST VARCHAR(16777216),
	CMTE_ZIP VARCHAR(16777216),
	CMTE_DSGN VARCHAR(16777216),
	CMTE_TP VARCHAR(16777216),
	CMTE_PTY_AFFILIATION VARCHAR(16777216),
	CMTE_FILING_FREQ VARCHAR(16777216),
	ORG_TP VARCHAR(16777216),
	CONNECTED_ORG_NM VARCHAR(16777216),
	CAND_ID VARCHAR(16777216),

	INGEST_TIMESTAMP TIMESTAMP_NTZ,
	SOURCE_FILE_NAME VARCHAR,
	SOURCE_FILE_ROW_NUMBER NUMBER,
	SOURCE_FILE_YEAR VARCHAR(4)
);

create or replace TABLE FEC.RAW.COMMITTEE_CONTRIBUTION (
	CMTE_ID VARCHAR(16777216),
	AMNDT_IND VARCHAR(16777216),
	RPT_TP VARCHAR(16777216),
	TRANSACTION_PGI VARCHAR(16777216),
	IMAGE_NUM VARCHAR(16777216),
	TRANSACTION_TP VARCHAR(16777216),
	ENTITY_TP VARCHAR(16777216),
	NAME VARCHAR(16777216),
	CITY VARCHAR(16777216),
	STATE VARCHAR(16777216),
	ZIP_CODE VARCHAR(16777216),
	EMPLOYER VARCHAR(16777216),
	OCCUPATION VARCHAR(16777216),
	TRANSACTION_DT VARCHAR(16777216),
	TRANSACTION_AMT VARCHAR(16777216),
	OTHER_ID VARCHAR(16777216),
	CAND_ID VARCHAR(16777216),
	TRAN_ID VARCHAR(16777216),
	FILE_NUM VARCHAR(16777216),
	MEMO_CD VARCHAR(16777216),
	MEMO_TEXT VARCHAR(16777216),
	SUB_ID VARCHAR(16777216),

	INGEST_TIMESTAMP TIMESTAMP_NTZ,
	SOURCE_FILE_NAME VARCHAR,
	SOURCE_FILE_ROW_NUMBER NUMBER,
	SOURCE_FILE_YEAR VARCHAR(4)
);

create or replace TABLE FEC.RAW.INDIVIDUAL_CONTRIBUTION (
	CMTE_ID VARCHAR(16777216),
	AMNDT_IND VARCHAR(16777216),
	RPT_TP VARCHAR(16777216),
	TRANSACTION_PGI VARCHAR(16777216),
	IMAGE_NUM VARCHAR(16777216),
	TRANSACTION_TP VARCHAR(16777216),
	ENTITY_TP VARCHAR(16777216),
	NAME VARCHAR(16777216),
	CITY VARCHAR(16777216),
	STATE VARCHAR(16777216),
	ZIP_CODE VARCHAR(16777216),
	EMPLOYER VARCHAR(16777216),
	OCCUPATION VARCHAR(16777216),
	TRANSACTION_DT VARCHAR(16777216),
	TRANSACTION_AMT VARCHAR(16777216),
	OTHER_ID VARCHAR(16777216),
	TRAN_ID VARCHAR(16777216),
	FILE_NUM VARCHAR(16777216),
	MEMO_CD VARCHAR(16777216),
	MEMO_TEXT VARCHAR(16777216),
	SUB_ID VARCHAR(16777216),

	INGEST_TIMESTAMP TIMESTAMP_NTZ,
	SOURCE_FILE_NAME VARCHAR,
	SOURCE_FILE_ROW_NUMBER NUMBER,
	SOURCE_FILE_YEAR VARCHAR(4)
);

    